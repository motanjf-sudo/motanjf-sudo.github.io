<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NovaChat</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:#e5ddd5;
}

/* -------- LOGIN -------- */
.login{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.login-box{
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:280px;
}
.login-box input, .login-box button{
  width:100%;
  margin-bottom:10px;
  padding:10px;
}

/* -------- APP -------- */
.app{
  max-width:420px;
  height:100vh;
  margin:auto;
  background:#fff;
  display:none;
  flex-direction:column;
}

/* HEADER */
header{
  background:#075e54;
  color:white;
  padding:14px;
  text-align:center;
  font-weight:600;
}

/* MAIN */
.main{
  flex:1;
  display:flex;
}

/* GROUP LIST */
.groups{
  width:120px;
  background:#f0f0f0;
  padding:6px;
  overflow-y:auto;
}
.groups button{
  width:100%;
  margin-bottom:6px;
  padding:6px;
  border:none;
  background:#ddd;
}
.groups small{
  display:block;
  text-align:center;
  opacity:.6;
}

/* CHAT */
.chat{
  flex:1;
  display:flex;
  flex-direction:column;
  background:#e5ddd5;
}
.messages{
  flex:1;
  padding:10px;
  overflow-y:auto;
}
.msg{
  max-width:75%;
  background:#fff;
  padding:8px;
  border-radius:6px;
  margin-bottom:6px;
  position:relative;
}
.me{
  background:#dcf8c6;
  margin-left:auto;
}
.msg button{
  position:absolute;
  top:4px;
  right:4px;
  border:none;
  background:none;
  cursor:pointer;
}

/* INPUT */
.input-bar{
  display:flex;
  padding:6px;
  background:#f0f0f0;
}
.input-bar textarea{
  flex:1;
  resize:none;
  padding:8px;
}
.input-bar button{
  margin-left:6px;
  padding:8px;
}

/* MOBILE */
@media(max-width:600px){
  .main{flex-direction:column}
  .groups{width:100%;display:flex;overflow-x:auto}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="login">
  <div class="login-box">
    <h3>NovaChat</h3>
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="auth()">Login / Sign up</button>
  </div>
</div>

<!-- APP -->
<div class="app" id="app">
  <header id="title">NovaChat</header>

  <div class="main">

    <!-- GROUPS -->
    <div class="groups">
      <button onclick="createGroup()">+ Group</button>
      <button onclick="joinGroup()">Join</button>
      <div id="groupList"></div>
      <small id="noGroup">No groups</small>
    </div>

    <!-- CHAT -->
    <div class="chat">
      <div class="messages" id="messages"></div>
      <div class="input-bar">
        <textarea id="input" placeholder="Message..."></textarea>
        <button onclick="send()">âž¤</button>
      </div>
    </div>

  </div>
</div>

<script>
let currentUser="";
let currentGroup="";

function auth(){
  if(!user.value||!pass.value)return;
  const users=JSON.parse(localStorage.users||"{}");
  if(!users[user.value]){
    users[user.value]=pass.value;
    localStorage.users=JSON.stringify(users);
  }
  if(users[user.value]!==pass.value){
    alert("Wrong password");return;
  }
  currentUser=user.value;
  login.style.display="none";
  app.style.display="flex";
  loadGroups();
}

function loadGroups(){
  groupList.innerHTML="";
  const groups=JSON.parse(localStorage.groups||"{}");
  let has=false;
  for(let g in groups){
    if(groups[g].members.includes(currentUser)){
      const b=document.createElement("button");
      b.textContent=g;
      b.onclick=()=>openGroup(g);
      groupList.appendChild(b);
      has=true;
    }
  }
  noGroup.style.display=has?"none":"block";
}

function createGroup(){
  const name=prompt("Group name");
  const pass=prompt("Password (min 5)");
  if(!name||!pass||pass.length<5)return;
  const groups=JSON.parse(localStorage.groups||"{}");
  groups[name]={pass, members:[currentUser], messages:[]};
  localStorage.groups=JSON.stringify(groups);
  loadGroups();
}

function joinGroup(){
  const name=prompt("Group name");
  const pass=prompt("Password");
  const groups=JSON.parse(localStorage.groups||"{}");
  if(!groups[name]||groups[name].pass!==pass){
    alert("Wrong");return;
  }
  if(!groups[name].members.includes(currentUser)){
    groups[name].members.push(currentUser);
    localStorage.groups=JSON.stringify(groups);
  }
  loadGroups();
}

function openGroup(g){
  currentGroup=g;
  title.textContent=g;
  messages.innerHTML="";
  const groups=JSON.parse(localStorage.groups||"{}");
  groups[g].messages.forEach(showMsg);
}

function send(){
  if(!input.value||!currentGroup)return;
  const groups=JSON.parse(localStorage.groups||"{}");
  const m={
    user:currentUser,
    text:input.value,
    time:new Date().toLocaleTimeString([],{
      hour:"2-digit",minute:"2-digit"
    })
  };
  groups[currentGroup].messages.push(m);
  localStorage.groups=JSON.stringify(groups);
  input.value="";
  showMsg(m);
}

function showMsg(m){
  const d=document.createElement("div");
  d.className="msg"+(m.user===currentUser?" me":"");
  d.innerHTML=`<b>${m.user}</b>: ${m.text}<br><small>${m.time}</small>`;
  if(m.user===currentUser){
    const del=document.createElement("button");
    del.textContent="ðŸ—‘ï¸";
    del.onclick=()=>{d.remove()};
    d.appendChild(del);
  }
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){
    e.preventDefault();send();
  }
});
</script>

</body>
</html>
