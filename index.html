<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NovaChat</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:#e6f2ef}

/* LOGIN */
.login{height:100vh;display:flex;justify-content:center;align-items:center}
.login-box{background:#fff;padding:20px;border-radius:12px;width:300px}
.login-box input,.login-box button{width:100%;margin-bottom:12px;padding:10px}
.switch{text-align:center;font-size:12px;color:#0f766e;cursor:pointer}

/* APP */
.app{max-width:560px;height:100vh;margin:auto;background:#fff;display:none;flex-direction:column}
header{background:#0f766e;color:white;padding:14px;text-align:center;font-weight:600}

/* MAIN */
.main{flex:1;display:flex}

/* GROUPS */
.groups{width:170px;background:#f0fdfa;padding:8px;overflow-y:auto}
.group-item{display:flex;gap:4px;margin-bottom:6px}
.group-item button{flex:1;padding:6px;border:none;border-radius:8px;font-size:13px}
.open{background:#99f6e4}
.leave{background:#fecaca;width:32px}
.delete{background:#f87171;width:32px;color:white}
.groups small{text-align:center;opacity:.6}

/* CHAT */
.chat{flex:1;display:flex;flex-direction:column;background:#f8fffd}
.messages{flex:1;padding:12px;overflow-y:auto}
.msg{max-width:78%;padding:10px 12px;border-radius:12px;margin-bottom:8px;background:#fff;white-space:pre-wrap;overflow-wrap:anywhere}
.me{background:#ccfbf1;margin-left:auto}

/* INPUT */
.input-bar{padding:8px;background:#ecfeff}
.emoji-bar span{font-size:20px;margin-right:6px;cursor:pointer}
.input-row{display:flex}
textarea{flex:1;resize:none;padding:10px;border-radius:10px;border:1px solid #ccc}
.input-row button{margin-left:6px;padding:10px;border:none;border-radius:50%;background:#0f766e;color:white}

/* MOBILE */
@media(max-width:600px){
.main{flex-direction:column}
.groups{width:100%;display:flex;overflow-x:auto}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="login">
  <div class="login-box">
    <h3 id="loginTitle">Create account</h3>
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="auth()">Continue</button>
    <div class="switch" onclick="resetAuth()">Create another account</div>
  </div>
</div>

<!-- APP -->
<div class="app" id="app">
  <header id="title">NovaChat</header>

  <div class="main">
    <div class="groups">
      <button onclick="createGroup()">+ Group</button>
      <button onclick="joinGroup()">Join</button>
      <div id="groupList"></div>
      <small id="noGroup">No groups</small>
    </div>

    <div class="chat">
      <div class="messages" id="messages"></div>
      <div class="input-bar">
        <div class="emoji-bar">
          <span onclick="addEmoji('üòÄ')">üòÄ</span>
          <span onclick="addEmoji('üòÇ')">üòÇ</span>
          <span onclick="addEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span>
          <span onclick="addEmoji('üî•')">üî•</span>
          <span onclick="addEmoji('üëç')">üëç</span>
        </div>
        <div class="input-row">
          <textarea id="input" placeholder="Message..."></textarea>
          <button onclick="send()">‚û§</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let currentUser="", currentGroup="";

/* AUTH */
function resetAuth(){user.value="";pass.value=""}
function auth(){
  if(!user.value||!pass.value)return;
  const users=JSON.parse(localStorage.users||"{}");
  if(!users[user.value]) users[user.value]=pass.value;
  else if(users[user.value]!==pass.value){alert("Wrong password");return}
  localStorage.users=JSON.stringify(users);
  currentUser=user.value;
  login.style.display="none";
  app.style.display="flex";
  loadGroups();
}

/* GROUPS */
function loadGroups(){
  groupList.innerHTML="";
  const groups=JSON.parse(localStorage.groups||"{}");
  let has=false;

  for(let g in groups){
    if(groups[g].members.includes(currentUser)){
      const wrap=document.createElement("div");
      wrap.className="group-item";

      const open=document.createElement("button");
      open.textContent=g;
      open.className="open";
      open.onclick=()=>openGroup(g);

      const leave=document.createElement("button");
      leave.textContent="üö™";
      leave.className="leave";
      leave.onclick=()=>leaveGroup(g);

      wrap.appendChild(open);
      wrap.appendChild(leave);

      if(groups[g].owner===currentUser){
        const del=document.createElement("button");
        del.textContent="üóëÔ∏è";
        del.className="delete";
        del.onclick=()=>deleteGroup(g);
        wrap.appendChild(del);
      }

      groupList.appendChild(wrap);
      has=true;
    }
  }
  noGroup.style.display=has?"none":"block";
}

function createGroup(){
  const name=prompt("Group name");
  const pass=prompt("Password (min 5)");
  if(!name||!pass||pass.length<5)return;
  const groups=JSON.parse(localStorage.groups||"{}");
  groups[name]={pass,owner:currentUser,members:[currentUser],messages:[]};
  localStorage.groups=JSON.stringify(groups);
  loadGroups();
}

/* JOIN GROUP ‚Äì ŸÑ€åÿ≥ÿ™ ŸáŸÖŸá ⁄Øÿ±ŸàŸá‚ÄåŸáÿß */
function joinGroup(){
  const groups=JSON.parse(localStorage.groups||"{}");
  const names=Object.keys(groups);
  if(names.length===0)return alert("No groups exist");

  const choice=prompt("Available groups:\n\n"+names.join("\n"));
  if(!choice||!groups[choice])return;

  const p=prompt("Enter password");
  if(groups[choice].pass!==p)return alert("Wrong password");

  if(!groups[choice].members.includes(currentUser)){
    groups[choice].members.push(currentUser);
    localStorage.groups=JSON.stringify(groups);
  }
  loadGroups();
}

function leaveGroup(g){
  if(!confirm("Leave "+g+" ?"))return;
  const groups=JSON.parse(localStorage.groups);
  groups[g].members=groups[g].members.filter(u=>u!==currentUser);
  localStorage.groups=JSON.stringify(groups);
  if(currentGroup===g){
    messages.innerHTML="";
    title.textContent="NovaChat";
    currentGroup="";
  }
  loadGroups();
}

function deleteGroup(g){
  if(!confirm("Delete group "+g+" ?"))return;
  const groups=JSON.parse(localStorage.groups);
  delete groups[g];
  localStorage.groups=JSON.stringify(groups);
  messages.innerHTML="";
  title.textContent="NovaChat";
  currentGroup="";
  loadGroups();
}

/* CHAT */
function openGroup(g){
  currentGroup=g;
  title.textContent=g;
  messages.innerHTML="";
  JSON.parse(localStorage.groups)[g].messages.forEach(showMsg);
}

function send(){
  if(!input.value||!currentGroup)return;
  const groups=JSON.parse(localStorage.groups);
  const m={user:currentUser,text:input.value,time:new Date().toLocaleTimeString([],{
    hour:"2-digit",minute:"2-digit"
  })};
  groups[currentGroup].messages.push(m);
  localStorage.groups=JSON.stringify(groups);
  input.value="";
  showMsg(m);
}

function showMsg(m){
  const d=document.createElement("div");
  d.className="msg"+(m.user===currentUser?" me":"");
  d.innerHTML=`<b>${m.user}</b>: ${m.text}<br><small>${m.time}</small>`;
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
}

function addEmoji(e){input.value+=e}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){
    e.preventDefault();send();
  }
});
</script>

</body>
</html>
