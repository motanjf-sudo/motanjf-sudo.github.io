<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NOVA Chat</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: sans-serif;
  background: #0f172a;
  color: white;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.app {
  width: 100%;
  max-width: 420px;
  background: #020617;
  border-radius: 10px;
  overflow: hidden;
}

/* ---------- AUTH ---------- */
.auth {
  padding: 20px;
}

.auth h2 {
  text-align: center;
  margin-bottom: 20px;
}

.tabs {
  display: flex;
  margin-bottom: 20px;
}

.tab {
  flex: 1;
  padding: 10px;
  text-align: center;
  cursor: pointer;
  background: #1e293b;
}

.tab.active {
  background: #38bdf8;
  color: black;
  font-weight: bold;
}

.form {
  display: none;
}

.form.active {
  display: block;
}

input {
  width: 100%;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 6px;
  border: none;
  outline: none;
}

/* ---------- CHAT ---------- */
.chat {
  display: none;
  flex-direction: column;
  height: 100vh;
  max-height: 100vh;
}

header {
  padding: 12px;
  background: #020617;
  text-align: center;
  font-weight: bold;
}

#messages {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
}

.msg {
  background: #1e293b;
  padding: 8px;
  border-radius: 6px;
  margin-bottom: 8px;
  font-size: 14px;
}

.time {
  font-size: 11px;
  opacity: 0.6;
}

footer {
  display: flex;
  padding: 10px;
  background: #020617;
}

footer input {
  flex: 1;
}

button {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 6px;
  background: #38bdf8;
  font-weight: bold;
  cursor: pointer;
}

.send-btn {
  width: auto;
  margin-left: 6px;
}
</style>
</head>

<body>

<div class="app">

<!-- AUTH -->
<div class="auth" id="auth">
  <h2>NOVA</h2>

  <div class="tabs">
    <div class="tab active" id="tabSignup" onclick="showSignup()">Sign up</div>
    <div class="tab" id="tabLogin" onclick="showLogin()">Login</div>
  </div>

  <!-- SIGN UP -->
  <div class="form active" id="signupForm">
    <input id="suUser" placeholder="Username">
    <input id="suPass" type="password" placeholder="Password">
    <button onclick="signup()">Create account</button>
  </div>

  <!-- LOGIN -->
  <div class="form" id="loginForm">
    <input id="liUser" placeholder="Username">
    <input id="liPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- CHAT -->
<div class="chat" id="chat">
  <header>NOVA Chat</header>
  <div id="messages"></div>
  <footer>
    <input id="input" placeholder="پیام بنویس..." />
    <button class="send-btn" onclick="send()">ارسال</button>
  </footer>
</div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDybhWHcf85KDoBYdFWYIPCH0df3oKy7vU",
  authDomain: "nova-chat-408a2.firebaseapp.com",
  databaseURL: "https://nova-chat-408a2-default-rtdb.firebaseio.com",
  projectId: "nova-chat-408a2",
  storageBucket: "nova-chat-408a2.firebasestorage.app",
  messagingSenderId: "481208222196",
  appId: "1:481208222196:web:40a1c47adb6dd3ec77f9a1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentUser = "";

/* ---------- UI ---------- */
function showSignup() {
  tabSignup.classList.add("active");
  tabLogin.classList.remove("active");
  signupForm.classList.add("active");
  loginForm.classList.remove("active");
}

function showLogin() {
  tabLogin.classList.add("active");
  tabSignup.classList.remove("active");
  loginForm.classList.add("active");
  signupForm.classList.remove("active");
}

/* ---------- AUTH ---------- */
function signup() {
  const u = suUser.value.trim();
  const p = suPass.value.trim();
  if (!u || !p) return alert("همه فیلدها را پر کن");

  db.ref("users/" + u).once("value", snap => {
    if (snap.exists()) {
      alert("این یوزرنیم قبلاً ثبت شده");
    } else {
      db.ref("users/" + u).set({ password: p });
      enterChat(u);
    }
  });
}

function login() {
  const u = liUser.value.trim();
  const p = liPass.value.trim();
  if (!u || !p) return alert("همه فیلدها را پر کن");

  db.ref("users/" + u).once("value", snap => {
    if (!snap.exists()) {
      alert("کاربر وجود ندارد");
    } else if (snap.val().password !== p) {
      alert("رمز اشتباه است");
    } else {
      enterChat(u);
    }
  });
}

/* ---------- CHAT ---------- */
function enterChat(u) {
  currentUser = u;
  auth.style.display = "none";
  chat.style.display = "flex";

  db.ref("messages").limitToLast(50).on("child_added", snap => {
    const m = snap.val();
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = `<b>${m.user}</b>: ${m.text}<br><span class="time">${m.time}</span>`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  });
}

function send() {
  if (!input.value.trim()) return;

  const now = new Date();
  const time = now.getHours() + ":" + String(now.getMinutes()).padStart(2, "0");

  db.ref("messages").push({
    user: currentUser,
    text: input.value,
    time: time
  });

  input.value = "";
}

input.addEventListener("keydown", e => {
  if (e.key === "Enter") send();
});
</script>

</body>
</html>
