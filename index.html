<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NovaChat</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:#e6f2ef;
}

/* -------- LOGIN -------- */
.login{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.login-box{
  background:#ffffff;
  padding:20px;
  border-radius:12px;
  width:300px;
  position:relative;
}
.login-box h3{
  margin-top:0;
  text-align:center;
}
.login-box input,
.login-box button{
  width:100%;
  margin-bottom:12px;
  padding:10px;
  font-size:14px;
}
.switch{
  font-size:12px;
  text-align:center;
  color:#0f766e;
  cursor:pointer;
}

/* -------- APP -------- */
.app{
  max-width:560px;
  height:100vh;
  margin:auto;
  background:#ffffff;
  display:none;
  flex-direction:column;
}

/* HEADER */
header{
  background:#0f766e;
  color:white;
  padding:14px;
  text-align:center;
  font-weight:600;
}

/* MAIN */
.main{
  flex:1;
  display:flex;
}

/* GROUP LIST */
.groups{
  width:140px;
  background:#f0fdfa;
  padding:8px;
  overflow-y:auto;
}
.groups button{
  width:100%;
  margin-bottom:6px;
  padding:6px;
  border:none;
  background:#99f6e4;
  border-radius:8px;
  font-size:13px;
}
.groups small{
  display:block;
  text-align:center;
  opacity:.6;
}

/* CHAT */
.chat{
  flex:1;
  display:flex;
  flex-direction:column;
  background:#f8fffd;
}
.messages{
  flex:1;
  padding:12px;
  overflow-y:auto;
}
.msg{
  max-width:78%;
  padding:10px 12px;
  border-radius:12px;
  margin-bottom:8px;
  position:relative;
  background:#ffffff;
  white-space:pre-wrap;
  overflow-wrap:anywhere;
}
.me{
  background:#ccfbf1;
  margin-left:auto;
}
.msg button{
  position:absolute;
  top:4px;
  right:6px;
  border:none;
  background:none;
  cursor:pointer;
  opacity:.6;
}

/* INPUT */
.input-bar{
  padding:8px;
  background:#ecfeff;
}
.emoji-bar{
  margin-bottom:4px;
}
.emoji-bar span{
  font-size:20px;
  margin-right:6px;
  cursor:pointer;
}
.input-row{
  display:flex;
}
.input-row textarea{
  flex:1;
  resize:none;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  min-height:42px;
}
.input-row button{
  margin-left:6px;
  padding:10px 14px;
  border:none;
  border-radius:50%;
  background:#0f766e;
  color:white;
  font-size:16px;
}

/* MOBILE */
@media(max-width:600px){
  .main{flex-direction:column}
  .groups{
    width:100%;
    display:flex;
    gap:6px;
    overflow-x:auto;
  }
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="login">
  <div class="login-box">
    <h3 id="loginTitle">Create account</h3>
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="auth()">Continue</button>
    <div class="switch" onclick="resetAuth()">Create another account</div>
  </div>
</div>

<!-- APP -->
<div class="app" id="app">
  <header id="title">NovaChat</header>

  <div class="main">

    <!-- GROUPS -->
    <div class="groups">
      <button onclick="createGroup()">+ Group</button>
      <button onclick="joinGroup()">Join</button>
      <div id="groupList"></div>
      <small id="noGroup">No groups</small>
    </div>

    <!-- CHAT -->
    <div class="chat">
      <div class="messages" id="messages"></div>

      <div class="input-bar">
        <div class="emoji-bar">
          <span onclick="addEmoji('üòÄ')">üòÄ</span>
          <span onclick="addEmoji('üòÇ')">üòÇ</span>
          <span onclick="addEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span>
          <span onclick="addEmoji('üî•')">üî•</span>
          <span onclick="addEmoji('üëç')">üëç</span>
        </div>
        <div class="input-row">
          <textarea id="input" placeholder="Message..."></textarea>
          <button onclick="send()">‚û§</button>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
let currentUser="";
let currentGroup="";

user.addEventListener("input",()=>{
  const users=JSON.parse(localStorage.users||"{}");
  if(users[user.value]){
    loginTitle.innerText="Welcome back";
    pass.placeholder="Password";
  }else{
    loginTitle.innerText="Create account";
    pass.placeholder="Choose a password";
  }
});

function resetAuth(){
  user.value="";
  pass.value="";
  loginTitle.innerText="Create account";
}

function auth(){
  if(!user.value||!pass.value)return;
  const users=JSON.parse(localStorage.users||"{}");

  if(!users[user.value]){
    users[user.value]=pass.value;
    localStorage.users=JSON.stringify(users);
  }else if(users[user.value]!==pass.value){
    alert("Wrong password");return;
  }

  currentUser=user.value;
  login.style.display="none";
  app.style.display="flex";
  loadGroups();
}

function loadGroups(){
  groupList.innerHTML="";
  const groups=JSON.parse(localStorage.groups||"{}");
  let has=false;
  for(let g in groups){
    if(groups[g].members.includes(currentUser)){
      const b=document.createElement("button");
      b.textContent=g;
      b.onclick=()=>openGroup(g);
      groupList.appendChild(b);
      has=true;
    }
  }
  noGroup.style.display=has?"none":"block";
}

function createGroup(){
  const name=prompt("Group name");
  const pass=prompt("Password (min 5)");
  if(!name||!pass||pass.length<5)return;
  const groups=JSON.parse(localStorage.groups||"{}");
  groups[name]={pass, members:[currentUser], messages:[]};
  localStorage.groups=JSON.stringify(groups);
  loadGroups();
}

function joinGroup(){
  const name=prompt("Group name");
  const pass=prompt("Password");
  const groups=JSON.parse(localStorage.groups||"{}");
  if(!groups[name]||groups[name].pass!==pass){
    alert("Wrong");return;
  }
  if(!groups[name].members.includes(currentUser)){
    groups[name].members.push(currentUser);
    localStorage.groups=JSON.stringify(groups);
  }
  loadGroups();
}

function openGroup(g){
  currentGroup=g;
  title.textContent=g;
  messages.innerHTML="";
  const groups=JSON.parse(localStorage.groups||"{}");
  groups[g].messages.forEach(showMsg);
}

function send(){
  if(!input.value||!currentGroup)return;
  const groups=JSON.parse(localStorage.groups||"{}");
  const m={
    user:currentUser,
    text:input.value,
    time:new Date().toLocaleTimeString([],{
      hour:"2-digit",minute:"2-digit"
    })
  };
  groups[currentGroup].messages.push(m);
  localStorage.groups=JSON.stringify(groups);
  input.value="";
  showMsg(m);
}

function showMsg(m){
  const d=document.createElement("div");
  d.className="msg"+(m.user===currentUser?" me":"");
  d.innerHTML=`<b>${m.user}</b>: ${m.text}<br><small>${m.time}</small>`;
  if(m.user===currentUser){
    const del=document.createElement("button");
    del.textContent="üóëÔ∏è";
    del.onclick=()=>{d.remove()};
    d.appendChild(del);
  }
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
}

function addEmoji(e){
  input.value+=e;
  input.focus();
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){
    e.preventDefault();
    send();
  }
});
</script>

</body>
</html>
